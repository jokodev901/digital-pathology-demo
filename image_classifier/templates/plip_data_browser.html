{% extends 'core/base.html' %}

{% block content %}
<article>
    {% include "_tab_header.html" %}

    <div class="filter-container">
        <details {% if filters_expanded %}open{% endif %}
                 hx-get="{% url 'update-filter-state' %}"
                 hx-trigger="toggle"
                 hx-vals='js:{state: event.target.open ? "open" : "closed"}'>

            <summary class="filter-summary">
                Filter Results
            </summary>

            <form class="noborder" method="GET" action="."
                hx-boost="true"
                hx-target="#filter-results"
                hx-swap="outerHTML show:none">
                <div class="filter-expected">
                    <label>
                    Expected label
                    <input type="text" name="expected" value="{{ request.GET.expected }}"
                        placeholder="e.g. tumor"
                        hx-get="."
                        hx-trigger="input changed delay:500ms, keyup[key=='Enter']"
                        hx-target="#filter-results"
                        hx-include="closest form"
                        hx-swap="outerHTML show:none"
                        hx-replace-url="true">
                    </label>
                </div>
                <div id="dynamic-filters">
                    {% for row in filter_rows %}
                        {% include "_filter_row.html" with index=row.index label_val=row.label min_val=row.min max_val=row.max %}
                    {% endfor %}
                </div>
                <div class="filter-score">
                    <button class="button-large" type="submit">Apply Filters</button>
                    <a href="." role="button" class="outline secondary">
                       Clear
                    </a>
                </div>
            </form>
        </details>
    </div>

    {% include "_filter_results.html" %}

</article>
{% endblock %}