{% extends 'core/base.html' %}

{% block content %}
<article>
    {% include "_tab_header.html" %}

    <div class="filter-container">
        <details {% if filters_expanded %}open{% endif %}
                 hx-get="{% url 'update-filter-state' %}"
                 hx-trigger="toggle"
                 hx-vals='js:{state: event.target.open ? "open" : "closed"}'>

            <summary class="filter-summary">
                Filter Results
            </summary>

            <form class="noborder" method="GET" action=".">
                <div class="filter-expected-container">
                    <div class="filter-expected">
                        <label>
                            Expected label<input type="text" name="expected" value="{{ request.GET.expected }}"
                                                 placeholder="e.g. tumor">
                        </label>
                    </div>
                </div>

                <div id="dynamic-filters">
                    {% for row in filter_rows %}
                        {% include "_filter_row.html" with index=row.index label_val=row.label min_val=row.min max_val=row.max %}
                    {% endfor %}
                </div>

                <div class="filter-score">
                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                    <a href="." class="btn btn-secondary">Clear</a>
                </div>
            </form>
        </details>
    </div>

    {% include "_page_nav.html" %}

    <table>
        <thead>
            <tr>
                <th>Image</th>
                <th>Classifications</th>
                <th>Expected</th>
            </tr>
        </thead>
        <tbody>
            {% for obj in submissions %}
            <tr>
                <td><img src="data:image/jpeg;base64,{{ obj.image.image_base64 }}"
                         alt="Uploaded Image" class="thumbnail"></td>
                <td>{{ obj.scores_str|safe }}</td>
                <td>{{ obj.expected_label|default_if_none:"" }}</td>
            {% empty %}
                <td colspan="2">No submissions found matching your criteria.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% include "_page_nav.html" %}
</article>
{% endblock %}